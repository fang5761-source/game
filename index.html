<!DOCTYPE html>
<html lang="zh-Hant">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>ä¹ä¹ä¹˜æ³•å¤§æŒ‘æˆ°</title>
   <!-- è¼‰å…¥ Tailwind CSS -->
   <script src="https://cdn.tailwindcss.com"></script>
   <style>
       /* UI èª¿æ•´ */
       @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
       body {
           font-family: 'Inter', sans-serif;
           background-color: #f7f7f7;
           display: flex;
           justify-content: center;
           align-items: flex-start;
           min-height: 98vh;
           padding-top: 8px;
       }
       .game-container {
           max-width: 320px;
           width: 100%;
           background-color: #ffffff;
           box-shadow: 0 6px 15px -2px rgba(0, 0, 0, 0.1);
           border-radius: 16px;
           padding: 12px;
           margin: 8px;
       }
       .answer-button {
           transition: all 0.15s ease-in-out;
           transform: scale(1);
       }
       .answer-button:active {
           transform: scale(0.98);
       }
       #feedback-message {
           min-height: 70px;
           line-height: 1.4;
           display: flex;
           flex-direction: column;
           justify-content: center;
           align-items: center;
       }
       @keyframes clap {
           0%, 100% { transform: scale(1) rotate(0deg); }
           25% { transform: scale(1.2) rotate(5deg); }
           50% { transform: scale(1) rotate(-5deg); }
           75% { transform: scale(1.2) rotate(5deg); }
       }
       .clap-animation {
           animation: clap 0.5s ease-in-out infinite;
       }
   </style>
</head>
<body>

<div class="game-container text-center">
   <h1 class="text-xl font-extrabold mb-3 text-purple-600">
       ä¹ä¹ä¹˜æ³•å¤§æŒ‘æˆ°
   </h1>
   
   <!-- éŠæˆ²è¨­å®š / é–‹å§‹ç•«é¢ -->
   <div id="setup-screen">
       <!-- æ™‚é–“é¸æ“‡å€å¡Š -->
       <div class="mb-4 p-3 bg-purple-100 rounded-lg shadow-inner">
           <p class="text-xs font-semibold text-purple-700 mb-2">æ¯é¡Œæ™‚é–“é™åˆ¶ (ç§’):</p>
           <div id="time-selector" class="flex justify-center space-x-1">
               <button data-time="1" onclick="setTimeLimit(1)" class="time-btn py-0.5 px-2 text-xs font-bold rounded-full transition duration-150">1 ç§’</button>
               <button data-time="2" onclick="setTimeLimit(2)" class="time-btn py-0.5 px-2 text-xs font-bold rounded-full transition duration-150">2 ç§’</button>
               <button data-time="3" onclick="setTimeLimit(3)" class="time-btn py-0.5 px-2 text-xs font-bold rounded-full transition duration-150">3 ç§’</button>
               <button data-time="5" onclick="setTimeLimit(5)" class="time-btn py-0.5 px-2 text-xs font-bold rounded-full transition duration-150">5 ç§’</button>
           </div>
       </div>
       
       <button id="start-button"
               class="w-full py-3 mb-2 bg-green-500 text-white text-base font-bold rounded-xl hover:bg-green-600 transition duration-150 ease-in-out shadow-lg"
               onclick="startGame()">
           é–‹å§‹æŒ‘æˆ° (å…± 10 é¡Œ)
       </button>
   </div>

   <!-- éŠæˆ²é€²è¡Œç•«é¢ -->
   <div id="game-screen" class="hidden">
       <!-- åˆ†æ•¸/é€²åº¦é¡¯ç¤º -->
       <div class="mb-3 p-1.5 bg-purple-100 rounded-lg shadow-inner">
           <p class="text-xs font-semibold text-purple-700">å›åˆé€²åº¦:</p>
           <span id="score-display" class="text-xl font-black text-purple-900">0/10</span>
       </div>
       
       <!-- æ™‚é–“é™åˆ¶é€²åº¦æ¢ -->
       <div class="w-full h-2 bg-gray-200 rounded-full mb-3 overflow-hidden shadow-inner">
           <div id="timer-bar"
                class="h-full bg-green-500 transition-all duration-150 ease-linear"
                style="width: 100%;">
           </div>
       </div>

       <!-- å•é¡Œå€å¡Š -->
       <div class="mb-4 p-3 bg-pink-50 rounded-xl border-4 border-pink-200">
           <p id="question" class="text-2xl font-extrabold text-gray-800">
               ? Ã— ? = ?
           </p>
       </div>

       <!-- ç­”æ¡ˆæŒ‰éˆ•å€å¡Š -->
       <div id="answer-buttons" class="grid grid-cols-2 gap-2 mb-3">
           <!-- æŒ‰éˆ•å°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
       </div>
   </div>

   <!-- æç¤º/çµæœè¨Šæ¯ -->
   <div id="feedback-message" class="text-sm font-semibold mt-3">
       <!-- è¨Šæ¯/ç¸½çµå°‡ç”± JS å‹•æ…‹æ›´æ–° -->
   </div>
   
   <!-- é‡ç©æŒ‰éˆ• -->
   <button id="reset-button"
           class="hidden w-full py-2 bg-red-500 text-white font-bold rounded-xl hover:bg-red-600 transition duration-150 ease-in-out shadow-md mt-3"
           onclick="resetToSetup()">
       å†ç©ä¸€æ¬¡
   </button>
</div>

<script>
   // --- éŠæˆ²è¨­å®šèˆ‡ç‹€æ…‹è®Šæ•¸ ---
   const TOTAL_QUESTIONS_IN_ROUND = 10;
   let correctAnswersInRound = 0;
   let currentQuestionIndex = 0;
   let correctAnswer = 0;
   let isGameActive = false;

   // æ™‚é–“é™åˆ¶ç›¸é—œè®Šæ•¸
   let timerId = null;
   let selectedTimeLimit = 2; // é è¨­ 2 ç§’
   const TICK_INTERVAL = 300; // é™ä½åˆ·æ–°é »ç‡ï¼Œè¼ƒç©©å®š
   let timeRemaining = selectedTimeLimit;

   // ç¦ç”¨éŸ³æ•ˆï¼Œé¿å… AudioContext é€ æˆç€è¦½å™¨ç•¶æ©Ÿ
   function playSound() { return; }

   // DOM å…ƒç´ å¼•ç”¨
   const scoreDisplay = document.getElementById('score-display');
   const questionElement = document.getElementById('question');
   const buttonsContainer = document.getElementById('answer-buttons');
   const feedbackElement = document.getElementById('feedback-message');
   const resetButton = document.getElementById('reset-button');
   const timerBar = document.getElementById('timer-bar');
   const timeButtons = document.querySelectorAll('.time-btn');
   const setupScreen = document.getElementById('setup-screen');
   const gameScreen = document.getElementById('game-screen');

   // --- è¼”åŠ©å‡½å¼ ---

   function safeClearTimer() {
       if (timerId !== null) {
           clearInterval(timerId);
           timerId = null;
       }
   }

   function shuffleArray(array) {
       for (let i = array.length - 1; i > 0; i--) {
           const j = Math.floor(Math.random() * (i + 1));
           [array[i], array[j]] = [array[j], array[i]];
       }
   }

   // --- éŠæˆ²æµç¨‹æ§åˆ¶ ---

   function setTimeLimit(seconds) {
       if (seconds < 1 || seconds > 10) return;
       selectedTimeLimit = seconds;

       timeButtons.forEach(btn => {
           const isSelected = parseInt(btn.getAttribute('data-time')) === seconds;
           if (isSelected) {
               btn.className = 'time-btn py-0.5 px-2 text-xs font-bold rounded-full transition duration-150 bg-purple-600 text-white shadow-md';
           } else {
               btn.className = 'time-btn py-0.5 px-2 text-xs font-bold rounded-full transition duration-150 bg-gray-200 text-gray-800 hover:bg-gray-300';
           }
       });
   }

   function timeUp() {
       if (!isGameActive) {
           safeClearTimer();
           return;
       }

       isGameActive = false;
       safeClearTimer();

       showCorrectAnswer(null);

       feedbackElement.className = 'text-base font-semibold mt-3 text-red-700';
       feedbackElement.textContent = `â±ï¸ æ™‚é–“åˆ°ï¼æœ¬é¡Œç­”æ¡ˆæ˜¯ ${correctAnswer}ã€‚`;
       playSound(false);

       setTimeout(handleNextState, 1500);
   }

   function startTimer() {
       safeClearTimer();

       timeRemaining = selectedTimeLimit;
       timerBar.style.width = '100%';

       timerId = setInterval(() => {
           timeRemaining -= TICK_INTERVAL / 1000;

           if (timeRemaining <= 0) {
               timeUp();
               return;
           }

           const percentage = (timeRemaining / selectedTimeLimit) * 100;
           timerBar.style.width = `${percentage}%`;
       }, TICK_INTERVAL);
   }

   function showCorrectAnswer(selectedButton) {
       document.querySelectorAll('.answer-button').forEach(btn => {
           btn.disabled = true;
           const value = parseInt(btn.getAttribute('data-answer'));
           if (value === correctAnswer) {
               btn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
               btn.classList.add('bg-green-400', 'text-gray-800');
           }
           if (selectedButton && btn === selectedButton) {
               btn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
               btn.classList.add('bg-red-500');
           }
       });
   }

   function checkAnswer(selectedAnswer, buttonElement) {
       if (!isGameActive) return;

       isGameActive = false;
       safeClearTimer();

       const isCorrect = selectedAnswer === correctAnswer;

       if (isCorrect) {
           correctAnswersInRound++;

           feedbackElement.className = 'text-base font-semibold mt-3 text-green-600';
           feedbackElement.textContent = `âœ… ç­”å°äº†ï¼`;

           buttonElement.className = buttonElement.className
               .replace('bg-blue-500', 'bg-green-500')
               .replace('hover:bg-blue-600', 'hover:bg-green-500');

           playSound(true);

           setTimeout(handleNextState, 800);
       } else {
           feedbackElement.className = 'text-base font-semibold mt-3 text-red-600';
           feedbackElement.textContent = `âŒ ç­”éŒ¯äº†ï¼`;

           showCorrectAnswer(buttonElement);
           playSound(false);

           setTimeout(handleNextState, 1500);
       }
   }

   function handleNextState() {
       feedbackElement.textContent = '';
       feedbackElement.classList.remove('clap-animation');

       currentQuestionIndex++;

       if (currentQuestionIndex < TOTAL_QUESTIONS_IN_ROUND) {
           isGameActive = true;
           generateQuestionContent();
       } else {
           endGameSummary();
       }
   }

   function endGameSummary() {
       safeClearTimer();
       isGameActive = false;

       gameScreen.classList.add('hidden');
       resetButton.classList.remove('hidden');

       const correct = correctAnswersInRound;
       const total = TOTAL_QUESTIONS_IN_ROUND;
       const accuracy = (correct / total) * 100;
       const isPerfect = correct === total;

       questionElement.textContent = 'æŒ‘æˆ°çµæŸï¼';
       buttonsContainer.innerHTML = '';

       let summaryHtml = `
           <p class="text-xl font-black text-purple-800 mb-1">ğŸ‰ å›åˆç¸½çµ ğŸ‰</p>
           <p class="text-sm font-semibold text-gray-700">ç¸½é¡Œæ•¸: ${total} é¡Œ  |  ç­”å°é¡Œæ•¸: ${correct} é¡Œ</p>
           <p class="text-3xl font-extrabold text-red-600 mt-2">${accuracy.toFixed(0)}%</p>
       `;
       let encouragement;

       if (isPerfect) {
           encouragement = `<div class="text-3xl font-black text-yellow-600 mt-3 clap-animation">ğŸ‘ å®Œç¾å…¨å°ï¼å¤ªæ£’äº†ï¼ ğŸ†</div>`;
       } else {
           encouragement = `<div class="text-xl font-black text-red-600 mt-3">ğŸ’ª æŒ‘æˆ°çµæŸï¼å†æ¥å†å²ï¼ŒåŠ æ²¹ï¼</div>`;
       }

       feedbackElement.className = 'text-center mt-3';
       feedbackElement.innerHTML = summaryHtml + encouragement;
   }

   // --- æ ¸å¿ƒéŠæˆ²åŠŸèƒ½ ---

   function generateQuestionContent() {
       try {
           // å…ˆé‡è¨­ç•«é¢ï¼Œé¿å…ç´¯ç©å¤ªå¤š DOM ç‹€æ…‹
           buttonsContainer.innerHTML = '';
           feedbackElement.textContent = '';

           const num1 = Math.floor(Math.random() * 9) + 1;
           const num2 = Math.floor(Math.random() * 9) + 1;

           correctAnswer = num1 * num2;

           questionElement.textContent = `${num1} Ã— ${num2} = ?`;
           scoreDisplay.textContent = `${currentQuestionIndex + 1}/${TOTAL_QUESTIONS_IN_ROUND}`;

           // å®‰å…¨ç”Ÿæˆé¸é …ï¼šå¾ 1~81 ä¸­é¸å‡º 3 å€‹ä¸åŒæ–¼æ­£è§£çš„æ•¸å­—
           const options = [correctAnswer];
           const pool = [];
           for (let v = 1; v <= 81; v++) {
               if (v !== correctAnswer) {
                   pool.push(v);
               }
           }
           shuffleArray(pool);
           options.push(pool[0], pool[1], pool[2]);

           shuffleArray(options);
           displayOptions(options);

           startTimer();
       } catch (e) {
           console.error('Error generating question content (CRITICAL):', e);
           safeClearTimer();
           isGameActive = false;
           feedbackElement.className = 'text-base font-semibold mt-3 text-red-700';
           feedbackElement.textContent = 'âŒ éŠæˆ²å‡ºéŒ¯ï¼Œè«‹é»æ“Šã€Œå†ç©ä¸€æ¬¡ã€é‡æ–°é–‹å§‹ã€‚';
           resetButton.classList.remove('hidden');
       }
   }

   function displayOptions(options) {
       if (!buttonsContainer) return;

       buttonsContainer.innerHTML = '';
       options.forEach(option => {
           const button = document.createElement('button');
           button.textContent = option;
           button.className = 'answer-button py-2.5 px-2 bg-blue-500 text-white text-lg font-bold rounded-xl shadow-lg hover:bg-blue-600 transition duration-150 ease-in-out';
           button.setAttribute('data-answer', option);
           button.onclick = () => checkAnswer(option, button);
           buttonsContainer.appendChild(button);
       });
   }

   function startGame() {
       safeClearTimer();
       correctAnswersInRound = 0;
       currentQuestionIndex = -1;
       isGameActive = false;

       setupScreen.classList.add('hidden');
       gameScreen.classList.remove('hidden');
       resetButton.classList.add('hidden');

       feedbackElement.innerHTML = '';
       feedbackElement.classList.remove('clap-animation');

       handleNextState();
   }

   function resetToSetup() {
       safeClearTimer();
       isGameActive = false;

       setupScreen.classList.remove('hidden');
       gameScreen.classList.add('hidden');
       resetButton.classList.add('hidden');

       feedbackElement.innerHTML = '';
       feedbackElement.classList.remove('clap-animation');

       questionElement.textContent = '? Ã— ? = ?';
       buttonsContainer.innerHTML = '';
       scoreDisplay.textContent = `0/${TOTAL_QUESTIONS_IN_ROUND}`;
   }

   // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
   window.onload = () => {
       setTimeLimit(selectedTimeLimit);
   };

   // å°‡æ ¸å¿ƒå‡½å¼æš´éœ²çµ¦å…¨åŸŸç’°å¢ƒ
   window.setTimeLimit = setTimeLimit;
   window.startGame = startGame;
   window.resetToSetup = resetToSetup;
   window.checkAnswer = checkAnswer;
</script>

</body>
</html>
